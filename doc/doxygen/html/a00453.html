<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Loki: Loki::Chunk Struct Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.4 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<div class="nav">
<b>Loki</b>::<a class="el" href="a00453.html">Chunk</a></div>
<h1>Loki::Chunk Struct Reference</h1><!-- doxytag: class="Loki::Chunk" --><a href="a00438.html">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00453.html#a0">Init</a> (std::size_t blockSize, unsigned char blocks)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00453.html#a1">Allocate</a> (std::size_t blockSize)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00453.html#a2">Deallocate</a> (void *p, std::size_t blockSize)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00453.html#a3">Reset</a> (std::size_t blockSize, unsigned char blocks)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a4"></a><!-- doxytag: member="Loki::Chunk::Release" ref="a4" args="()" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00453.html#a4">Release</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Releases the allocated block of memory. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a5"></a><!-- doxytag: member="Loki::Chunk::HasBlock" ref="a5" args="(unsigned char *p, std::size_t chunkLength) const " -->
bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00453.html#a5">HasBlock</a> (unsigned char *p, std::size_t chunkLength) const </td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns true if block at address P is inside this <a class="el" href="a00453.html">Chunk</a>. <br></td></tr>
<tr><td colspan="2"><br><h2>Public Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="o0"></a><!-- doxytag: member="Loki::Chunk::pData_" ref="o0" args="" -->
unsigned char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00453.html#o0">pData_</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Pointer to array of allocated blocks. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="o1"></a><!-- doxytag: member="Loki::Chunk::firstAvailableBlock_" ref="o1" args="" -->
unsigned char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00453.html#o1">firstAvailableBlock_</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Index of first empty block. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="o2"></a><!-- doxytag: member="Loki::Chunk::blocksAvailable_" ref="o2" args="" -->
unsigned char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00453.html#o2">blocksAvailable_</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Count of empty blocks. <br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
about each allocated <a class="el" href="a00453.html">Chunk</a>. This is a POD-style struct with value-semantics.<p>
<dl compact><dt><b>Minimal Interface</b></dt><dd>For the sake of runtime efficiency, no constructor, destructor, or copy-assignment operator is defined. The inline functions made by the compiler should be sufficient, and perhaps faster than hand-crafted functions. The lack of these functions allows vector to create and copy Chunks as needed without overhead. The Init and Release functions do what the default constructor and destructor would do. A <a class="el" href="a00453.html">Chunk</a> is not in a usable state after it is constructed and before calling Init. Nor is a <a class="el" href="a00453.html">Chunk</a> usable after Release is called, but before the destructor.</dd></dl>
<dl compact><dt><b>Efficiency</b></dt><dd>Down near the lowest level of the allocator, runtime efficiencies trump almost all other considerations. Each function does the minimum required of it. All functions should execute in constant time to prevent higher- level code from unwittingly using a version of Shlemiel the Painter's Algorithm.</dd></dl>
<dl compact><dt><b>Stealth Indexes</b></dt><dd>The first char of each empty block contains the index of the next empty block. These stealth indexes form a singly-linked list within the blocks. A <a class="el" href="a00453.html">Chunk</a> is corrupt if this singly-linked list has a loop or is shorter than blocksAvailable_. Much of the allocator's time and space efficiency comes from how these stealth indexes are implemented.</dd></dl>

<p>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="a1"></a><!-- doxytag: member="Loki::Chunk::Allocate" ref="a1" args="(std::size_t blockSize)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void * Loki::Chunk::Allocate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">std::size_t&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>blockSize</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Allocate a block within the <a class="el" href="a00453.html">Chunk</a>. Complexity is always O(1), and this will never throw. Does not actually "allocate" by calling malloc, new, or any other function, but merely adjusts some internal indexes to indicate an already allocated block is no longer available. <dl compact><dt><b>Returns:</b></dt><dd>Pointer to block within <a class="el" href="a00453.html">Chunk</a>.</dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="a2"></a><!-- doxytag: member="Loki::Chunk::Deallocate" ref="a2" args="(void *p, std::size_t blockSize)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void Loki::Chunk::Deallocate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void *&nbsp;</td>
          <td class="mdname" nowrap> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>std::size_t&nbsp;</td>
          <td class="mdname" nowrap> <em>blockSize</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Deallocate a block within the <a class="el" href="a00453.html">Chunk</a>. Complexity is always O(1), and this will never throw. For efficiency, this assumes the address is within the block and aligned along the correct byte boundary. An assertion checks the alignment, and a call to HasBlock is done from within VicinityFind. Does not actually "deallocate" by calling free, delete, or other function, but merely adjusts some internal indexes to indicate a block is now available.    </td>
  </tr>
</table>
<a class="anchor" name="a0"></a><!-- doxytag: member="Loki::Chunk::Init" ref="a0" args="(std::size_t blockSize, unsigned char blocks)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool Loki::Chunk::Init           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">std::size_t&nbsp;</td>
          <td class="mdname" nowrap> <em>blockSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned char&nbsp;</td>
          <td class="mdname" nowrap> <em>blocks</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Initializes a just-constructed <a class="el" href="a00453.html">Chunk</a>. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>blockSize</em>&nbsp;</td><td>Number of bytes per block. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>blocks</em>&nbsp;</td><td>Number of blocks per <a class="el" href="a00453.html">Chunk</a>. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>True for success, false for failure.</dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="a3"></a><!-- doxytag: member="Loki::Chunk::Reset" ref="a3" args="(std::size_t blockSize, unsigned char blocks)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void Loki::Chunk::Reset           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">std::size_t&nbsp;</td>
          <td class="mdname" nowrap> <em>blockSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned char&nbsp;</td>
          <td class="mdname" nowrap> <em>blocks</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Resets the <a class="el" href="a00453.html">Chunk</a> back to pristine values. The available count is set back to zero, and the first available index is set to the zeroth block. The stealth indexes inside each block are set to point to the next block. This assumes the Chunk's data was already using Init.    </td>
  </tr>
</table>
<hr>The documentation for this struct was generated from the following file:<ul>
<li>D:/temp/loki/src/SmallObj.cpp</ul>
<hr size="1"><address style="align: right;"><small>Generated on Thu Sep 29 10:16:21 2005 for Loki by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.4 </small></address>
</body>
</html>
